# Adding the CatVision.io Display

CatVision.io provides the remote access via [app.catvision.io](https://app.catvision.io).
Additionally, it offers the option to integrate the component _CatVision.io Display_ into third-party applications. 
Operators can then use remote access directly from existing tools such as Salesforce (CRM) or ZenDesk (Customer support).

CatVision.io Display is an HTML5 component that requires JavaScript and WebSockets.

## How it works

Prior jumping to code, here is a brief intro into how _CatVision.io Display_ works.

![Add CatVision.io SDK dependency via Android Studio](../assets/cvio_display_arch.png)

## Prerequisites

 * _CatVision.io Secret API Key_ \(see [Catvision.io API Key](//get-started/api-key.md)\)

_Security note: We recommend to generate a dedicated API Key for each CatVision.io Display and not to share it. If one API Key get compromised, only one integration will be affected._

## 1. Obtain the authorization token

The _CatVision.io Display_ is authorized for remote access by a time limited `AUTHORIZATION_TOKEN`. This authorization token has to be obtained by _Operator Application Server_ (this is your application backend code) using _Secret API key_ \(`SECRET_API_KEY`\) from a _app.catvision.io_ API via a REST call. The authorization token is an opaque string. The authorization token is valid for XX minutes and the application has to obtain a new token after a timeout.

The relevant _app.catvision.io_ API endpoint is available at `https://app.catvision.io/api/authtoken`.  
You need to provide the `[SECRET_API_KEY]` in an HTTP header item `X-SC-SecretAPIKey`.

The example of a response in JSON format from `https://app.catvision.io/api/authtoken`:  

```json
{
    "auth_token": "88e52eebd7c992b3e95597596996e693_1502538423.52.61d94fb4b845b8b25181fd1b375513905c61f5a80e706481eb052fc6",
    "ok": 1
}
```


Here is an example of how to fetch the authorization token using some of the popular languages.

### PHP

```php
<?php
$url = 'https://app.catvision.io/api/authtoken';
$secret_api_key = '[SECRET_API_KEY]';
$options = array(
    'http' => array(
        'header'  => "X-SC-SecretAPIKey: $secret_api_key\r\n",
        'method'  => 'POST',
        'content' => ''
    )
);
$context  = stream_context_create($options);
$result = file_get_contents($url, false, $context);
$obj = json_decode($result);
$auth_token = $obj->{'auth_token'};
```

### Python

```py
import requests, json
r = requests.post('https://app.catvision.io/api/authtoken', headers={
    'X-SC-SecretAPIKey' : '[SECRET_API_KEY]'
})
res = json.loads(r.text)
auth_token = res['auth_token']
```

### curl

```
$ curl \
	-H "X-SC-SecretAPIKey: [SECRET_API_KEY]" \
	--data "" \
	https://app.catvision.io/api/authtoken
```

## 2. Include CatVision.io Display

Load the CatVision.io Display component:

```html
<head>
    ...
    <script type="text/javascript" src="https://cdn.teskalabs.com/cvio.min.js"></script>
    ...
</head>
```

Put this initialization code immediately after the `<body>` tag.
This code must be generated by your application backend code with an `AUTHORIZATION_TOKEN` obtained in a first step.

```html
<body>
	<script type="text/javascript">
		CVIO.init({authToken: '[AUTHORIZATION_TOKEN]'});
	</script>
...
```

## 3. Display a remote screen

You need to have an existing `<canvas id='mycanvas'>` in a DOM of your HTML page. 
This is, how you instantiate a CatVision Display and connect it to a remote client application identified by `[CLIENT_HANDLE]`.

```html
<canvas id='cviocanvas'>
...
<script type="text/javascript">
    var cvioDisplay = new CVIODisplay({
        target:       document.getElementById('cviocanvas'),
        clientHandle: '[CLIENT_HANDLE]',
    });
    cvioDisplay.connect();
</script>
```

## Custom Client Handle support

If you want to use your custom Client Handle initialize and connect to the CatVision like this:

```js
var cvioDisplay = new CVIODisplay({
    target:          document.getElementById('cviocanvas'),
    deviceHandle:    '[CLIENT_HANDLE]',
    deviceHandleKey: 'u'
});
cvioDisplay.connect();
```

The option `deviceHandleKey: 'u'` says you want to identify the device by custom client handle.

