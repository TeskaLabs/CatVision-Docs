<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>CatVision documentation</title>
  	<meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
  </head>
  <body>

    <header>
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <a href="https://teskalabs.com/">
                <img src="/assets/images/brand.png">
            </a>
          </div>
          <div class="col-md-8">
            <div class="links">
              <a href="https://docs.teskalabs.com/">Docs</a>
              <a href="https://teskalabs.com/blog/">Blog</a>
              <a href="https://teskalabs.com/contact">Contact</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="col-md-12 pt-3">
        <h1 id="adding-a-catvisionio-sdk-into-an-android-application">Adding a CatVision.io SDK into an Android application</h1>

<p>In this section we describe how to integrate a CatVision.io SDK into an Android application so that an operator can access it remotely.</p>

<h2 id="prerequisities">Prerequisities</h2>

<ul>
  <li>A source code of the Android application</li>
  <li>Android Studio</li>
  <li><em>CatVision.io API Key ID</em> (see <a href="//get-started/api-key.md">Catvision.io API Key</a>)</li>
</ul>

<p><em>Remark about Android version requirement:</em> Android provides the screen capture functionality starting from API level 21 respective Android 5.0. CatVision.io SDK for Android can be integrated into applications targeting older Android versions, but screen sharing will not be functional.</p>

<h2 id="add-the-catvisionio-sdk">Add the CatVision.io SDK</h2>

<p>Insert a following line into <code class="highlighter-rouge">dependencies</code> section of your Android application <code class="highlighter-rouge">build.gradle</code> and press ‘Sync Now’. Android Studio will automatically download an <em>CatVision.io SDK</em> from <a href="https://bintray.com/teskalabs/CatVision.io/catvision-io-sdk-android">JCenter</a> and integrate it into the application source code.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compile 'com.teskalabs.cvio:catvision-io-sdk-android:+'
</code></pre></div></div>

<p><img src="../assets/cvio_android_studio_dependencies.png" alt="Add CatVision.io SDK dependency via Android Studio" /></p>

<p>The CatVision.io SDK is now added to your Android application.</p>

<h2 id="add-the-catvisionio-api-key-id">Add the CatVision.io API Key ID</h2>

<p><em>CatVision.io API Key ID</em> has to be added into the <em>App Manifest</em> (or <code class="highlighter-rouge">AndroidManifest.xml</code>) of the Android app so that the application authenticates properly to <a href="https://app.catvision.io">catvision.io</a>. See <a href="//get-started/api-key.md">Catvision.io API Key</a> for more information of how to get obtain <em>CatVision.io API Key ID</em> if you don’t have one.</p>

<p>Open <code class="highlighter-rouge">AndroidManifest.xml</code> file of your Android app and add a <code class="highlighter-rouge">&lt;meta-data android:name="cvio.api_key_id" ...&gt;</code> line into <code class="highlighter-rouge">&lt;application&gt;</code> tag:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;application</span> <span class="err">...</span><span class="nt">&gt;</span>

...
<span class="nt">&lt;meta-data</span> <span class="na">android:name=</span><span class="s">"cvio.api_key_id"</span> <span class="na">android:value=</span><span class="s">"[CatVision.io API Key ID]"</span> <span class="nt">/&gt;</span>
...

<span class="nt">&lt;/application&gt;</span>
</code></pre></div></div>

<p><img src="../assets/cvio_android_studio_manifest.png" alt="CatVision.io API Key ID is added to AndroidManifest.xml" /></p>

<h2 id="start-a-screen-sharing">Start a screen sharing</h2>

<p>The application needs to implement start and stop actions of CatVision.io screen sharing. In this example we are going to implement start and stop buttons in the options menu.</p>

<p>Add the following code to the Activity class:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
<span class="kn">import</span> <span class="nn">com.teskalabs.cvio.CatVision</span><span class="o">;</span>
<span class="o">...</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">CatVision</span> <span class="n">catvision</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">menuItemStartScreenShareId</span> <span class="o">=</span> <span class="mi">1101</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">menuItemStopScreenShareId</span> <span class="o">=</span> <span class="mi">1102</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">CATVISION_REQUEST_CODE</span> <span class="o">=</span> <span class="mi">1103</span><span class="o">;</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>

        <span class="o">...</span>
        <span class="c1">// Obtain a CatVision.io SDK reference</span>
        <span class="n">catvision</span> <span class="o">=</span> <span class="n">CatVision</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">...</span>

    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onPrepareOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">menu</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">menuGroup1Id</span> <span class="o">=</span> <span class="mi">1100</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">catvision</span><span class="o">.</span><span class="na">isStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">menu</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">menuGroup1Id</span><span class="o">,</span> <span class="n">menuItemStartScreenShareId</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="s">"Share screen"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">menu</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">menuGroup1Id</span><span class="o">,</span> <span class="n">menuItemStopScreenShareId</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="s">"Stop sharing"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onPrepareOptionsMenu</span><span class="o">(</span><span class="n">menu</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onOptionsItemSelected</span><span class="o">(</span><span class="n">MenuItem</span> <span class="n">item</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="o">...</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">menuItemStartScreenShareId</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">catvision</span><span class="o">.</span><span class="na">requestStart</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">menuItemStopScreenShareId</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">getItemId</span><span class="o">()</span> <span class="o">==</span> <span class="n">menuItemStopScreenShareId</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">catvision</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="o">...</span>

        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onOptionsItemSelected</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="n">CATVISION_REQUEST_CODE</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">catvision</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>Screen sharing function is ready. You can compile the application now and start it.</p>

<p>When screen sharing is started in the mobile apps, you should see the connected client at <a href="https://app.catvision.io">app.catvision.io</a>:</p>

<p><img src="../assets/cvio_android_emulator_share.png" alt="Android Application connected to CatVision.io" /></p>


      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <span class="text-muted">© 2014-2019 TeskaLabs Ltd.</span>
          </div>
        </div>
      </div>
    </footer>

  </body>
</html>